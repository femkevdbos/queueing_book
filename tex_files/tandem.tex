
\section{Tandem queues}
\label{sec:tandem-queues}


\subsection*{Theory and Exercises}

\Opensolutionfile{hint}
\Opensolutionfile{ans}


Consider two $M/M/1$ stations in tandem. Suppose we can remove the variability in the service processing times at one, but not both, of the servers. Which one is the better one to spend it on, in terms of reducing waiting times?  After we obtained some insights into this question, we will provide a model to approximate the waiting time in a tandem  of $G/G/1$ queues.

\begin{exercise}
Assuming that jobs arrive at the first station at rate $\lambda$, and are served at rate $\mu_i$ at station $i$, show that the average queueing time for the tandem of two $M/M/1$ queues is given by
\begin{equation}
\E{W_Q}  = \frac{\rho_1}{1-\rho_1} \frac1{\mu_1} + \frac{\rho_2}{1-\rho_2} \frac1{\mu_2},
\end{equation}
where $\rho_i = \lambda/\mu_i$ and $\E{S_i} = 1/\mu_i$, for $i=1,2$. 
\begin{hint}
Focus on the waiting times for each station separately, and realize that each is an $M/M/1$ queue. What is the arrival process at the second station? Recall Burke's law, c.f., \ref{ex:burke}.
\end{hint}
\begin{solution}
The first queue is the familiar $M/M/1$ queue.  (Why?) For the sequel
it is important to observe that the departure process of the first
station, i.e., the distribution of times between jobs leaving the
first station, is the same as the arrival process. Consequently, the
inter-departure times are also exponentially distributed with parameter~$\lambda$. (However, the service times are exponentially distributed
with parameter $\mu_1$. ) 

What can we say about the second station?  Clearly, the jobs departing
at the first stations are the arrivals at the second station. Hence,
the departure process being exponential with rate $\lambda$, the
inter-arrival times at the second station are also exponential with
rate~$\lambda$. Consequently, the second queue is also an $M/M/1$
queue.

The total waiting time in the
system, i.e., the time spent in both queues, is the sum of the waiting
times at the first and second station. As each is an $M/M/1$ queue,
the total waiting time has the form:
\begin{equation}
  \begin{split}
\E{W_Q}  &= \E{W_{Q,1}} + \E{W_{Q,2}} \\
&= \frac{\rho_1}{1-\rho_1} \frac1{\mu_1} + \frac{\rho_2}{1-\rho_2} \frac1{\mu_2},
  \end{split}
\end{equation}
where $\rho_i = \lambda/\mu_i$ and $\E{S_i} = 1/\mu_i$, for $i=1,2$. 
\end{solution}
\end{exercise}


\begin{exercise}
Suppose we can remove all variability of  service process at the second station. Show that  in this case  the total time in queue is equal to
\begin{equation*}
  \E{W_Q}= \frac{\rho_1}{1-\rho_1} \frac1{\mu_1} +
  \frac12\frac{\rho_2}{1-\rho_2} \frac1{\mu_2}.
\end{equation*}
\begin{hint}
  If we can reduce all service variability at the second server, the second station can be modeled as an $M/D/1$ queue.
\end{hint}
\begin{solution}
As we reduce the variability of the second server, the service process
is no longer exponential. However, the arrival process at the second
station is still Poisson. As a consequence, the queueing discipline
changes to the $M/G/1$ queue. The expected waiting time for this case
has the form:
\begin{equation}\label{eq:200}
\E{W_{Q,2}} = \frac{1+C_{s,2}^2}2\frac{\rho_2}{1-\rho_2} \frac1{\mu_2},
\end{equation}
where $C_{s,2}^2$ is the squared coefficient of variation of the
service process of the second server.

By assumption we can entirely remove the variability of the second
server.  This yields that the coefficient of variation
$C_{s,2}^s = 0$. Thus, the service process being deterministic, the
second station becomes the $M/D/1$ queue.

The expected waiting time for the $M/D/1$ queue follows immediately
from~(\ref{eq:200}) by setting $C_{s,2}^2 =0$:
\begin{equation}\label{eq:300}
\E{W_{Q,2}} = \frac{1}2\frac{\rho_2}{1-\rho_2} \frac1{\mu_2}.
\end{equation}
Clearly, this is half the waiting time of the  $M/M/1$ queue. 

Since we do not change the first station in any way, this is still an
$M/M/1$ queue. 
Thus, the total time in queue for this scenario becomes:
\begin{equation*}
  \E{W_Q}= \frac{\rho_1}{1-\rho_1} \frac1{\mu_1} +
  \frac12\frac{\rho_2}{1-\rho_2} \frac1{\mu_2}. 
\end{equation*}
\end{solution}
\end{exercise}

\begin{exercise}
Suppose now that we reduce the variability of the service process of the first station.
Motivate that 
\begin{equation*}
  \E{W_Q}= \frac12\frac{\rho_1}{1-\rho_1} \frac1{\mu_1} +
  \frac12\frac{\rho_2}{1-\rho_2} \frac1{\mu_2}
\end{equation*}
is a reasonable approximation of the queueing time. Compare this to the queueing time of the reference situation.
  \begin{hint}
    Realize that now also the distribution of inter-departure times of the first station changes and becomes more regular.
  \end{hint}
  \begin{solution}
Analogous to the previous situation, suppose we can set the coefficient of variation
$C_{1,s}^2$ of the first server to zero. Thus, this becomes an $M/D/1$
queue, so that, similar to~(\ref{eq:300}):
\begin{equation*}
\E{W_{Q,1}} = \frac{1}2\frac{\rho_1}{1-\rho_1} \frac1{\mu_1}.
\end{equation*}

Contrary to the $M/M/1$ queue, the inter-departures of the $M/D/1$
queue are not exponentially distributed. When the first
server is busy, they are deterministic. When the first server is idle, we first
need to wait for the next arrival, which is exponentially distributed, and then for this arrival to finish its service, which
takes $D$. Thus, the time to the next departure is $X+D$.  

However, for the sake of simplicity, let us simply assume in the sequel of this
example that the departure process \emph{is} deterministic.

As we previously remarked, the departure process of the first station
forms the arrival process at the second station.  Since the departures
are assumed to be deterministic, the arrivals at the second station
are also deterministic.  The service times at the second station, however, are still
exponential.  Thus, the second station can be modeled as
the $D/M/1$ queue. For this queue we need to derive an expression for
the waiting time. The simplest approximation follows from an
expression for the waiting time of the $G/G/1$ queue.

We know that the expected waiting time for the $G/G/1$ queue has
the approximate form:
\begin{equation}\label{eq:500}
\E{W_{Q,2}} = \frac{C_{a,2}^2+C_{s,2}^2}2\frac{\rho_2}{1-\rho_2} \frac1{\mu_2}.
\end{equation}
Clearly, for our case, the coefficient of  variation $C_{a,s}^2$ of the
arrival process becomes, approximately, $0$, while $C_{s,2}^2 = 1$,
since the service process is still exponential. Hence,
\begin{equation}\label{eq:400}
\E{W_{Q,2}} = \frac12\frac{\rho_2}{1-\rho_2} \frac1{\mu_2}.
\end{equation}

Combining~(\ref{eq:500}) and~(\ref{eq:400}), the total  time in queue
becomes:
\begin{equation*}
  \E{W_Q}= \frac12\frac{\rho_1}{1-\rho_1} \frac1{\mu_1} +
  \frac12\frac{\rho_2}{1-\rho_2} \frac1{\mu_2}, 
\end{equation*}
which is half the waiting time of the two $M/M/1$ stations in tandem, but also smaller than the situation in which we reduce the variability at the second station.
  \end{solution}
\end{exercise}

\begin{exercise}
  What do you conclude from the above exercises?
  \begin{hint}
    What would you do if there would be third station in this tandem network?
  \end{hint}
  \begin{solution}
As a general guide line, it seems best to reduce the
variability at the first station. The main point to remember is that
reducing the variability of the service process at the first station
also reduces the variability of its departure process, hence the
variability of the arrival processes at the second station. Thus, the
situation improves at two locations of the chain of stations, rather
than at one.
  \end{solution}
\end{exercise}

For a tandem network of $G/G/1$ queues, observe that the SCV of the departure process $C_{d,i}^2$ of the $i$th station $i$ is the SCV of the arrival process $C_{a,i+1}^2$ at station $i+1$.  Thus, if we have $C_{d,i}^2$ we can compute the average waiting time at station $i+1$ by means of the $G/G/1$ waiting time approximation. 

To obtain an estimate for $C_{d,i}^2$ we reason as follows. Suppose that the load $\rho_i$ at station~$i$ is very high. Then the server will seldom be idle, so that the departure process must be reasonable well approximated by the service process. If, however, the load is small, the server will be idle most of the time, and inter-departure times must be  approximately distributed as the inter-arrival times. Based on this, we interpolate between these two extremes to get
\begin{equation}
  \label{eq:40}
  C_{d,i}^2 \approx (1-\rho_i^2) C_{a,i}^2 + \rho_i^2 C_{s,i}^2.
\end{equation}


\begin{exercise}
What is $C_d^2$ for the $D/D/1$ queue according to~\eqref{eq:40}?
\begin{solution}
  Since the inter-arrival times and the service times are deterministic, $C_a^2=C_s^2=0$. Hence $C_d^2=0$. 
\end{solution}
\end{exercise}

\begin{exercise}
What is $C_d^2$ for the $M/M/1$ queue according to~\eqref{eq:40}?  

\begin{solution}
  Since the inter-arrival times and the service times are exponential, $C_a^2=C_s^2=1$. Hence $C_d^2=1$. This is precisely in line with our earlier insights, in which we obtained that the departure process of an $M/M/1$ queue is Poisson.
\end{solution}
\end{exercise}

\begin{exercise}
  Use~\eqref{eq:40} to show for the $G/D/1$ that $C_d^2 < C_a^2$. 
  \begin{solution}
As $C_s^2 = 0$ for the $G/D/1$ queue, $C_3^2 = (1-\rho^2) C_a^2 < C_a^2$, as $\rho<1$. 
  \end{solution}
\end{exercise}

\begin{exercise}
Consider two $G/G/1$ station in tandem. Suppose $\lambda=2$ per hour, $C_{a,1}^2=2$ at station~1, $C_s^2=0.5$ at both stations, and $\E{S_1}=20$ minutes and $\E{S_2}=25$ minutes. What is the total time jobs spend on average in the system? What is the average number of jobs in the network?

\begin{solution}
First station 1.
\begin{pyconsole}
labda = 2.
S1 = 20./60
rho1 = labda*S1
rho1
ca1 = 2.
cs1 = 0.5
EW1 = (ca1+cs1)/2 * rho1/(1-rho1) * S1
EW1
W1 = EW1 + S1
W1
\end{pyconsole}

Now station 2. We first need to compute $C_{d1}^2$. 

\begin{pyconsole}
cd1 = (1-rho1**2)*ca1 + rho1**2*cs1
cd1
\end{pyconsole}


\begin{pyconsole}
labda = 2
S2 = 25./60
rho2 = labda*S2
rho2
ca2 = cd1 # here we use our formula
cs2 = 0.5
EW2 = (ca2+cs2)/2 * rho2/(1-rho2) * S2
EW2
W2 = EW2 + S2
W2
\end{pyconsole}

With Little's law.
\begin{pyconsole}
W=W1+W2
W
L = labda*W
L
\end{pyconsole}


\end{solution}
\end{exercise}

For a $G/G/c$ queue, we can use the following approximation
\begin{equation}\label{eq:57}
  C_{d,i}^2 = 1 + (1-\rho_i^2)(C_{a,i}^2-1) + \frac{\rho_i^2}{\sqrt{c_i}}(C_{s,i}^2-1).
\end{equation}

\begin{exercise}
  Show that~\eqref{eq:57} reduces to \eqref{eq:40} for the $G/G/1$ queue.
  \begin{solution}
    Since $c=1$ for the $G/G/1$ queue, we get
\begin{align*}
  C_{d}^2 
&= 1 + (1-\rho^2)(C_{a}^2-1) + \rho^2(C_{s}^2-1) \\
&= 1 + C_a^2 - \rho^2 C_{a}^2 -1 + \rho^2  + \rho^2 C_{s}^2 -\rho^2.
&= (1-\rho^2) C_a^2  + \rho^2 C_{s}^2.
\end{align*}
  \end{solution}
\end{exercise}


For the interested reader we refer to Zijm, Section 2.4.2, for a discussion of an extension for $G/G/c$ queues in tandem, and to networks. In particular, in networks we need to be concerned with output streams merging into a single input stream at one station, and the splitting of the output stream of a station to several other stations. The algorithm discussed in Zijm, Section 2.4.2, is mainly useful for numerical analysis. We will not discuss it here. 





\Closesolutionfile{hint}
\Closesolutionfile{ans}

\opt{solutionfiles}{
\subsection*{Hints}
\input{hint}
\subsection*{Solutions}
\input{ans}
}
%\clearpage

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../booktest"
%%% End:
